<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>C∆°n m∆∞a l·ªùi ch√∫c 20/11 ‚ú®</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: radial-gradient(circle at center, #2b3f70 0%, #0a1433 100%);
      font-family: "Poppins", "Segoe UI", sans-serif;
      color: #fff;
    }
    canvas { display: block; }

    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.25), rgba(0,0,0,0.5));
      opacity: 0.7;
      z-index: -1;
      animation: glowBg 6s ease-in-out infinite alternate;
    }
    @keyframes glowBg {
      from { filter: brightness(1.1); opacity: 0.6; }
      to { filter: brightness(1.4); opacity: 0.8; }
    }
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 22px;
      font-weight: 600;
      text-shadow: 0 0 15px #fff;
    }

    #music-control {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.4);
      color: #fff;
      padding: 8px 15px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      user-select: none;
      backdrop-filter: blur(4px);
      transition: all 0.3s;
    }
    #music-control:hover {
      background: rgba(255,255,255,0.3);
    }
  </style>
</head>
<body>
  <div id="loading">Loading...üòâ</div>
  <button id="music-control">üîä</button>
  <audio id="bg-music" loop preload="auto">
    <source src="./music/Anh L√† Th·∫±ng T·ªìi.mp3" type="audio/mpeg">
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    const CONFIG = {
      messageCount: 150,
      iconCount: 50,
      starCount: 2000,
      teacherImageCount: 10,
      areaSize: 700,
      fallSpeed: 0.8,
      teacherImages: [
        "./images/0abb95f22ca0a0fef9b1.jpg",
        "./images/53cb76bcf0ee7cb025ff.jpg",
        "./images/67fb6f3dd66f5a31037e.jpg",
        "./images/73435048d61a5a44030b.jpg",
        "./images/d5217d7dfb2f77712e3e.jpg"
    ],
      messages: [
        "üå∏ Ch√∫c m·ª´ng ng√†y Nh√† gi√°o Vi·ªát Nam 20/11 üå∏",
        "K√≠nh ch√∫c th·∫ßy c√¥ lu√¥n m·∫°nh kh·ªèe, h·∫°nh ph√∫c ‚ù§Ô∏è",
        "C·∫£m ∆°n th·∫ßy c√¥ ƒë√£ t·∫≠n t√¢m d√¨u d·∫Øt h·ªçc tr√≤ üè´",
        "Th·∫ßy c√¥ l√† ng·ªçn h·∫£i ƒëƒÉng soi s√°ng t∆∞∆°ng lai üåü",
        "Tri √¢n ng∆∞·ªùi l√°i ƒë√≤ th·∫ßm l·∫∑ng üö§",
        "Ch√∫c c√¥ lu√¥n t∆∞∆°i tr·∫ª, nhi·ªát huy·∫øt v√† y√™u ngh·ªÅ üå∑",
        "Th·∫ßy c√¥ ‚Äì ng∆∞·ªùi gieo h·∫°t ∆∞·ªõc m∆° üí´",
        "M·ªôt ng√†y 20/11 th·∫≠t nhi·ªÅu ni·ªÅm vui v√† y√™u th∆∞∆°ng üéâ",
        "Ch√∫c th·∫ßy c√¥ tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng t√≠ch c·ª±c ‚òÄÔ∏è",
        "Em m√£i bi·∫øt ∆°n nh·ªØng b√†i h·ªçc v√† t√¨nh th∆∞∆°ng c·ªßa th·∫ßy c√¥ üíñ",
        "Ng∆∞·ªùi th·∫Øp s√°ng con ƒë∆∞·ªùng tri th·ª©c ‚ú®",
        "T√¨nh th·∫ßy c√¥ l√† ng·ªçn l·ª≠a ·∫•m √°p su·ªët ƒë·ªùi üî•",
        "C·∫£m ∆°n c√¥ v√¨ nh·ªØng b√†i gi·∫£ng tr√†n ƒë·∫ßy y√™u th∆∞∆°ng üíï",
        "C·∫£m ∆°n th·∫ßy v√¨ ƒë√£ truy·ªÅn c·∫£m h·ª©ng v√† ƒëam m√™ üéì",
        "Th·∫ßy c√¥ ‚Äì ng∆∞·ªùi d·∫´n ƒë∆∞·ªùng t·∫≠n t√¢m v√† bao dung üåª",
        "Ch√∫c th·∫ßy c√¥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe v√† h·∫°nh ph√∫c üí™",
        "Nh·ªØng b√†i h·ªçc h√¥m nay l√† h√†nh trang mai sau üìñ",
        "K√≠nh ch√∫c th·∫ßy c√¥ lu√¥n r·∫°ng r·ª° n·ª• c∆∞·ªùi üåû"
      ],
      icons: ["üå∏", "‚ù§Ô∏è", "üåü", "üìö", "üíñ", "‚ú®", "üåª", "üçÄ", "üéì", "üñãÔ∏è", "üíê", "üåπ"]
    };

    let scene, camera, renderer, controls;
    const wishes = [], fallingIcons = [], teacherPhotos = [], shootingStars = [];
    let stars;

    init();
    animate();
    createShootingStars();

    function init() {
      document.getElementById("loading").remove();
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 3000);
      camera.position.set(0, 250, 900);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(innerWidth, innerHeight);
      renderer.setPixelRatio(devicePixelRatio);
      document.body.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.04;

      const ambient = new THREE.AmbientLight(0xffffff, 3.5);
      scene.add(ambient);

      const pointLight = new THREE.PointLight(0xffb3ff, 3.5, 2000);
      pointLight.position.set(0, 300, 400);
      scene.add(pointLight);

      createStars();
      createWishes();
      createIcons();
      createTeacherPhotos(CONFIG.teacherImages);

      window.addEventListener("resize", onWindowResize);

      const btn = document.getElementById("music-control");
      const audio = document.getElementById("bg-music");
      let playing = false;
      btn.addEventListener("click", () => {
        if (!playing) {
          audio.play();
          btn.textContent = "üîà";
          playing = true;
        } else {
          audio.pause();
          btn.textContent = "üîä";
          playing = false;
        }
      });
    }

    function getRandomWarmColor() {
      // T·∫°o m√†u trong d·∫£i ƒë·ªè -> cam -> h·ªìng -> t√≠m
      const hue = 0 + Math.random() * 25; // kho·∫£ng 0-25 (ƒë·ªè-cam)
      const altHue = Math.random() < 0.4 ? 320 + Math.random() * 20 : hue; // th·ªânh tho·∫£ng pha t√≠m-h·ªìng
      const sat = 70 + Math.random() * 30;
      const light = 55 + Math.random() * 15;
      return `hsl(${altHue}, ${sat}%, ${light}%)`;
    }

    function createStars() {
      const geometry = new THREE.BufferGeometry();
      const vertices = [];
      for (let i = 0; i < CONFIG.starCount; i++) {
        vertices.push(
          (Math.random() - 0.5) * 6000,
          (Math.random() - 0.5) * 6000,
          (Math.random() - 0.5) * 6000
        );
      }
      geometry.setAttribute("position", new THREE.Float32BufferAttribute(vertices, 3));
      const material = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 4,
        opacity: 0.9,
        transparent: true
      });
      stars = new THREE.Points(geometry, material);
      scene.add(stars);
    }

    function createTextSprite(message, isIcon = false) {
      const testCanvas = document.createElement("canvas");
      const testCtx = testCanvas.getContext("2d");
      const fontSize = isIcon ? 160 : 140;
      testCtx.font = isIcon ? `bold ${fontSize}px 'Segoe UI Emoji'` : `900 ${fontSize}px 'Poppins'`;
      const textWidth = testCtx.measureText(message).width;
      const padding = 300;
      const canvasWidth = Math.min(4096, textWidth + padding);
      const canvasHeight = 1024;

      const canvas = document.createElement("canvas");
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;
      const ctx = canvas.getContext("2d");

      const fillColor = getRandomWarmColor();

      ctx.shadowColor = "rgba(255, 255, 255, 0.5)";
      ctx.shadowBlur = 20;
      ctx.font = testCtx.font;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.lineWidth = 6;
      ctx.strokeStyle = "rgba(255,255,255,0.9)";
      ctx.strokeText(message, canvasWidth / 2, canvasHeight / 2);
      ctx.fillStyle = fillColor;
      ctx.fillText(message, canvasWidth / 2, canvasHeight / 2);

      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
      const sprite = new THREE.Sprite(material);
      const scaleX = isIcon ? 45 : Math.min(320, textWidth / 8);
      const scaleY = isIcon ? 45 : 70;
      sprite.scale.set(scaleX, scaleY, 1);
      return sprite;
    }

    function createWishes() {
      for (let i = 0; i < CONFIG.messageCount; i++) {
        const text = CONFIG.messages[Math.floor(Math.random() * CONFIG.messages.length)];
        const sprite = createTextSprite(text);
        sprite.position.set(
          (Math.random() - 0.5) * CONFIG.areaSize * 3,
          Math.random() * CONFIG.areaSize,
          (Math.random() - 0.5) * CONFIG.areaSize * 3
        );
        scene.add(sprite);
        wishes.push(sprite);
      }
    }

    function createIcons() {
      for (let i = 0; i < CONFIG.iconCount; i++) {
        const icon = CONFIG.icons[Math.floor(Math.random() * CONFIG.icons.length)];
        const sprite = createTextSprite(icon, true);
        sprite.position.set(
          (Math.random() - 0.5) * CONFIG.areaSize * 3,
          Math.random() * CONFIG.areaSize,
          (Math.random() - 0.5) * CONFIG.areaSize * 3
        );
        scene.add(sprite);
        fallingIcons.push(sprite);
      }
    }

    function createTeacherPhotos(urls) {
      const loader = new THREE.TextureLoader();
      for (let i = 0; i < CONFIG.teacherImageCount; i++) {
        const url = urls[Math.floor(Math.random() * urls.length)];
        loader.load(url, (texture) => {
          const mat = new THREE.SpriteMaterial({
            map: texture,
            transparent: true,
            opacity: 0.9
          });
          const photo = new THREE.Sprite(mat);
          const scale = 200 + Math.random() * 100;
          photo.scale.set(scale, scale, 1);
          photo.position.set(
            (Math.random() - 0.5) * CONFIG.areaSize * 3,
            Math.random() * CONFIG.areaSize,
            (Math.random() - 0.5) * CONFIG.areaSize * 3
          );
          scene.add(photo);
          teacherPhotos.push(photo);
        });
      }
    }

    function createShootingStars() {
      const geo = new THREE.BufferGeometry();
      geo.setAttribute('position', new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));
      const mat = new THREE.LineBasicMaterial({ color: 0xffffff, transparent:true, opacity:0.8 });
      for (let i=0; i<10; i++) {
        const line = new THREE.Line(geo, mat.clone());
        resetShootingStar(line);
        scene.add(line);
        shootingStars.push(line);
      }
    }

    function resetShootingStar(line) {
      line.position.set(
        (Math.random()-0.5)*2000,
        500 + Math.random()*500,
        (Math.random()-0.5)*800
      );
      line.userData.vx = -10 - Math.random()*15;
      line.userData.vy = -8 - Math.random()*10;
      line.material.opacity = 0.8;
    }

    function updateShootingStars() {
      for (const star of shootingStars) {
        star.position.x += star.userData.vx;
        star.position.y += star.userData.vy;
        star.material.opacity -= 0.008;
        if (star.material.opacity <= 0) resetShootingStar(star);
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      stars.rotation.y += 0.00025;
      stars.rotation.x += 0.00025;

      [...wishes, ...fallingIcons, ...teacherPhotos].forEach((obj) => {
        obj.position.y -= CONFIG.fallSpeed;
        if (obj.position.y < -CONFIG.areaSize / 2) {
          obj.position.y = CONFIG.areaSize / 2;
          obj.position.x = (Math.random() - 0.5) * CONFIG.areaSize * 3;
          obj.position.z = (Math.random() - 0.5) * CONFIG.areaSize * 3;
        }
        obj.rotation.z += 0.002;
      });

      updateShootingStars();
      renderer.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = innerWidth / innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    }
  </script>
</body>
</html>
